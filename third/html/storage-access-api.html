<!doctype html>
<ul id="ul">
</ul>
<button onclick="start()">Activate: StorageAccessAPI</button>
<script>
  const ul = document.getElementById('ul');
  function appendLog(label, text) {
    const li = document.createElement('li');
    li.innerText = `${label}: ${text}`;
    ul.appendChild(li);
  }

  async function start() {
    while (ul.firstChild) ul.removeChild(ul.firstChild)

    let successed = true;
    await document.requestStorageAccess()
    .catch(err => {
      successed = false;
    });

    appendLog('requestStorageAccess', successed ? 'Successed!' : 'Failed');


    appendLog('Referrer', document.referrer);
    appendLog('StorageAccessAPI', typeof document.hasStorageAccess === 'function' && document.hasStorageAccess() ? 'Supported!' : 'Unsupported');

    const prevCookie = document.cookie.split(/;\s?/).find(element => element.indexOf('prevCookie') == 0);
    appendLog('PrevCookie', prevCookie ? prevCookie : 'Not Found');

    document.cookie = 'cookie=1;';
    appendLog('Cookie', document.cookie.indexOf('cookie=1') >= 0 ? 'Writable!' : 'Not Writable');

    const prevSecureCookie = document.cookie.split(/;\s?/).find(element => element.indexOf('prevSecureCookie') == 0);
    appendLog('PrevSecureCookie', prevSecureCookie ? prevSecureCookie : 'Not Found');
    if (!prevSecureCookie) document.cookie = 'prevSecureCookie=' + Math.random();

    document.cookie = 'secureCookie=4;secure';
    appendLog('SecureCookie', document.cookie.indexOf('secureCookie=4') >= 0 ? 'Writable!' : 'Not Writable');

    const prevItem = localStorage.getItem('prevItem');
    appendLog('LocalStorage PrevItem', prevItem ? prevItem : 'Not Found');
    if (!prevItem) localStorage.setItem('prevItem', Math.random());

    localStorage.setItem('item', Math.random());
    const item = localStorage.getItem('item');
    appendLog('LocalStorage', item ? 'Writable!' : 'Not Writable');
  }
</script>
</ul>
